name: GitHell

on:
  schedule:
    - cron: '*/5 * * * *'
  workflow_dispatch:

concurrency:
  group: githell
  cancel-in-progress: true

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4       # v4
        with:
          fetch-depth: 0

      - uses: actions/setup-java@v4     # v4
        with:
          distribution: temurin
          java-version: '11'

      - name: Import GPG key
        uses: crazy-max/ghaction-import-gpg@v6   # v6
        with:
          gpg_private_key: ${{ secrets.GPG_PRIVATE_KEY }}
          passphrase: ${{ secrets.GPG_PASSPHRASE }}
          git_commit_gpgsign: true

      - name: Update abyss README
        env:
          EXECUTION_COUNT: ${{ steps.exec.outputs.count }}
        run: |
          mkdir -p abyss
          current_time=$(date -u +"%Y-%m-%dT%H:%M:%SZ")
          total_commits=$(git rev-list --count HEAD)
          for ((i=0;i<1000;i++)); do
            commit_id=$(uuidgen)
            {
              echo "Commit ID: $commit_id"
              echo "Commit: $((total_commits + i + 1))"
              echo "Execution Count: $EXECUTION_COUNT"
              echo "Timestamp: $current_time"
              echo "--------------------------------"
            } >> abyss/README.yml
          done
          git add abyss/README.yml
          git config user.name "Jyrrel"
          git config user.email "jyrrel789@gmail.com"
          git commit -S -m "ðŸŒ‘ 1000 abyss entries (run $EXECUTION_COUNT)"
          git push
